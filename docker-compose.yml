version: '3.8'

services:
  scan-agent:
    build: .
    container_name: scan-agent
    restart: unless-stopped
    network_mode: "host"       # <-- keep host mode
    volumes:
      - .:/app
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      # - HOST_IP=192.168.10.11
    depends_on:
      - openvas

  openvas:
    image: immauss/openvas:latest
    container_name: openvas
    restart: unless-stopped
    ports:
      - "9390:9390"
      - "9392:9392"
      - "443:9392"
    cap_add:
      - NET_ADMIN
    environment:
      - OV_UPDATE=1
      - PUBLIC_HOSTNAME=localhost
    volumes:
      - openvas_data:/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:443/"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - scan-network   # <-- only OpenVAS is on a bridge network

networks:
  scan-network:
    driver: bridge

volumes:
  openvas_data:
